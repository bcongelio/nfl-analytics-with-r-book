<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Bradley Congelio">
<title>Introduction to NFL Analytics with R - 2&nbsp; Wrangling NFL Data in the tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-nfl-analytics-functions.html" rel="next">
<link href="./01-nfl-analytics-and-r.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script defer="" data-domain="bradcongelio.com/nfl-analytics-with-r-book" src="https://plausible.io/js/script.js"></script><link rel="shortcut icon" href="favicon.ico">
<meta property="og:title" content="Introduction to NFL Analytics with R - 2&nbsp; Wrangling NFL Data in the tidyverse">
<meta property="og:description" content="">
<meta property="og:image" content="https://bradcongelio.com/nfl-analytics-with-r-book/images/feature.png">
<meta property="og:site-name" content="Introduction to NFL Analytics with R">
<meta property="og:locale" content="es_ES">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="Introduction to NFL Analytics with R - 2&nbsp; Wrangling NFL Data in the tidyverse">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://bradcongelio.com/nfl-analytics-with-r-book/images/feature.png">
<meta name="twitter:creator" content="@bradcongelio">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02-nfl-analytics-tidyverse.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling NFL Data in the `tidyverse`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to NFL Analytics with R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/bcongelio/nfl-analytics-with-r-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-nfl-analytics-and-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to NFL Analytics and the R Programming Language</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-nfl-analytics-tidyverse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling NFL Data in the <code>tidyverse</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-nfl-analytics-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NFL Analytics with the <code>nflverse</code> Family of Packages</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-nfl-analytics-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization with NFL Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-nfl-analytics-advanced-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Model Creation with NFL Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-nfl-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a1-nfl-analytics-dictionary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">NFL Analytics Quick Reference Guide</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a2-nfl-further-reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Further Reading Suggestions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a3-nfl-errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#downloading-r-and-rstudio" id="toc-downloading-r-and-rstudio" class="nav-link active" data-scroll-target="#downloading-r-and-rstudio"><span class="header-section-number">2.1</span> Downloading R and RStudio</a>
  <ul class="collapse">
<li><a href="#downloading-r" id="toc-downloading-r" class="nav-link" data-scroll-target="#downloading-r"><span class="header-section-number">2.1.1</span> Downloading R</a></li>
  <li><a href="#downloading-rstudio" id="toc-downloading-rstudio" class="nav-link" data-scroll-target="#downloading-rstudio"><span class="header-section-number">2.1.2</span> Downloading RStudio</a></li>
  <li><a href="#the-layout-of-rstudio" id="toc-the-layout-of-rstudio" class="nav-link" data-scroll-target="#the-layout-of-rstudio"><span class="header-section-number">2.1.3</span> The Layout of RStudio</a></li>
  <li><a href="#running-code-in-rstudio" id="toc-running-code-in-rstudio" class="nav-link" data-scroll-target="#running-code-in-rstudio"><span class="header-section-number">2.1.4</span> Running Code in RStudio</a></li>
  </ul>
</li>
  <li><a href="#installing-and-loading-necessary-packages" id="toc-installing-and-loading-necessary-packages" class="nav-link" data-scroll-target="#installing-and-loading-necessary-packages"><span class="header-section-number">2.2</span> Installing and Loading Necessary Packages</a></li>
  <li><a href="#the-tidyverse-and-its-verbs" id="toc-the-tidyverse-and-its-verbs" class="nav-link" data-scroll-target="#the-tidyverse-and-its-verbs"><span class="header-section-number">2.3</span> The <code>tidyverse</code> and Its Verbs</a></li>
  <li><a href="#the-flow-of-the-tidyverse" id="toc-the-flow-of-the-tidyverse" class="nav-link" data-scroll-target="#the-flow-of-the-tidyverse"><span class="header-section-number">2.4</span> The Flow of the <code>tidyverse</code></a></li>
  <li>
<a href="#working-with-nfl-data-and-the-dplyr-verbs" id="toc-working-with-nfl-data-and-the-dplyr-verbs" class="nav-link" data-scroll-target="#working-with-nfl-data-and-the-dplyr-verbs"><span class="header-section-number">2.5</span> Working With NFL Data and the <code>dplyr</code> Verbs</a>
  <ul class="collapse">
<li><a href="#nfl-data-and-the-filter-verb" id="toc-nfl-data-and-the-filter-verb" class="nav-link" data-scroll-target="#nfl-data-and-the-filter-verb"><span class="header-section-number">2.5.1</span> NFL Data and the <code>filter()</code> verb</a></li>
  <li><a href="#nfl-data-and-the-group_by-verb" id="toc-nfl-data-and-the-group_by-verb" class="nav-link" data-scroll-target="#nfl-data-and-the-group_by-verb"><span class="header-section-number">2.5.2</span> NFL Data and the <code>group_by()</code> verb</a></li>
  <li><a href="#nfl-data-and-the-summarize-verb" id="toc-nfl-data-and-the-summarize-verb" class="nav-link" data-scroll-target="#nfl-data-and-the-summarize-verb"><span class="header-section-number">2.5.3</span> NFL Data and the <code>summarize()</code> verb</a></li>
  <li><a href="#nfl-data-and-the-mutate-verb" id="toc-nfl-data-and-the-mutate-verb" class="nav-link" data-scroll-target="#nfl-data-and-the-mutate-verb"><span class="header-section-number">2.5.4</span> NFL Data and the <code>mutate()</code> verb</a></li>
  </ul>
</li>
  <li>
<a href="#core-skills-for-tidy-data" id="toc-core-skills-for-tidy-data" class="nav-link" data-scroll-target="#core-skills-for-tidy-data"><span class="header-section-number">2.6</span> Core Skills for Tidy Data</a>
  <ul class="collapse">
<li><a href="#importing-and-conducting-exploratory-data-analysis" id="toc-importing-and-conducting-exploratory-data-analysis" class="nav-link" data-scroll-target="#importing-and-conducting-exploratory-data-analysis"><span class="header-section-number">2.6.1</span> Importing and Conducting Exploratory Data Analysis</a></li>
  <li><a href="#dealing-with-missing-data" id="toc-dealing-with-missing-data" class="nav-link" data-scroll-target="#dealing-with-missing-data"><span class="header-section-number">2.6.2</span> Dealing with Missing Data</a></li>
  <li><a href="#changing-variable-types" id="toc-changing-variable-types" class="nav-link" data-scroll-target="#changing-variable-types"><span class="header-section-number">2.6.3</span> Changing Variable Types</a></li>
  <li><a href="#correct-and-create-new-variables-using-mutate" id="toc-correct-and-create-new-variables-using-mutate" class="nav-link" data-scroll-target="#correct-and-create-new-variables-using-mutate"><span class="header-section-number">2.6.4</span> Correct and Create New Variables Using <code>mutate</code></a></li>
  <li><a href="#merging-datasets-with-dplyr-and-mutating-joins" id="toc-merging-datasets-with-dplyr-and-mutating-joins" class="nav-link" data-scroll-target="#merging-datasets-with-dplyr-and-mutating-joins"><span class="header-section-number">2.6.5</span> Merging Datasets with <code>dplyr</code> and Mutating Joins</a></li>
  </ul>
</li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.7</span> Exercises</a>
  <ul class="collapse">
<li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1"><span class="header-section-number">2.7.1</span> <strong>Exercise 1</strong></a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2"><span class="header-section-number">2.7.2</span> <strong>Exercise 2</strong></a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3"><span class="header-section-number">2.7.3</span> <strong>Exercise 3</strong></a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4"><span class="header-section-number">2.7.4</span> <strong>Exercise 4</strong></a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5"><span class="header-section-number">2.7.5</span> <strong>Exercise 5</strong></a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/bcongelio/nfl-analytics-with-r-book/edit/origin/02-nfl-analytics-tidyverse.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/bcongelio/nfl-analytics-with-r-book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wrangling NFL Data in the <code>tidyverse</code></span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="downloading-r-and-rstudio" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="downloading-r-and-rstudio">
<span class="header-section-number">2.1</span> Downloading R and RStudio</h2>
<p>Prior to downloading R and RStudio, it is important to explain the difference between the two, as they are separate pieces of our analytics puzzle that are used for differing purposes. R is the core programming language used for statistical computing and graphics. R provides a wide range of statistical and graphical techniques and has a large community of users who develop and maintain a multitude of packages (essentially libraries of pre-written functions) that extend the capabilities and ease of coding. While R can be run from your computer’s command line, it also has an integrated development environment (IDE) in RStudio that provides a graphical user interface for working with R scripts, data files, and packages.</p>
<p>RStudio is free to download and use and provides a user-friendly interface for writing R code, organizing projects and files, and working with both big and small data. Regularly updated by the <a href="https://posit.co/">Posit team</a>, RStudio includes many features that are specifically designed to making working with R easier, including syntax highlighting, code suggestions, robust debugging tools, and a built-in package manager.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important that you download and successfully install R before proceeding to install RStudio on your computer.</p>
</div>
</div>
<section id="downloading-r" class="level3" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="downloading-r">
<span class="header-section-number">2.1.1</span> Downloading R</h3>
<ol type="1">
<li>To download R, visit the official R website at <a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a>
</li>
<li>Click on the ‘CRAN’ link at the top of the page, directly underneath the word ‘Download.’ This will bring you to the Comprehensive R Archive Network.</li>
<li>Each mirror that hosts a copy of R is sorted by country. Select a mirror that is geographically close to you.</li>
<li>Click on the version of R that is appropriate for your operating system (Linux, macOS, or Windows).</li>
<li>Select the ‘base’ option to download an updated version of R to your computer.</li>
<li>Open the downloaded file and follow the provided installation instructions.</li>
</ol></section><section id="downloading-rstudio" class="level3" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="downloading-rstudio">
<span class="header-section-number">2.1.2</span> Downloading RStudio</h3>
<ol type="1">
<li>To download RStudio, visit the official RStudio website at <a href="https://posit.co" class="uri">https://posit.co</a>
</li>
<li>Click on the ‘Download RStudio’ button in the top-right of the page.</li>
<li>Scroll down and select ‘Download’ within the ‘RStudio Desktop - Free’ box.</li>
<li>Open the downloaded file and follow the provided installation instructions.</li>
</ol></section><section id="the-layout-of-rstudio" class="level3" data-number="2.1.3"><h3 data-number="2.1.3" class="anchored" data-anchor-id="the-layout-of-rstudio">
<span class="header-section-number">2.1.3</span> The Layout of RStudio</h3>
<p>When you open RStudio for the first time, you will see the interface laid out as in the picture below (sourced from the <a href="https://docs.posit.co/ide/user/ide/guide/ui/ui-panes.html">official RStudio documentation from posit</a>).</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/rstudio-layout_6605e0959e8eb498f2e6bb056f019c21">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/rstudio-panes-with-labels.jpeg" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">RStudio Layout</figcaption></figure>
</div>
</div>
</div>
<p>As you can see, RStudio provides a graphical interface for working with R and is sorted into four main panes, each of which serves a specific purpose.</p>
<ol type="1">
<li>
<strong>The source pane</strong>: In the upper-left, the source pane is where you write and run your R code. It serves as the main working pane within RStudio.</li>
<li>
<strong>The console pane:</strong> the console pane serves multiple functions, including allowing you to interact directly with R by typing commands and receiving the output. Additionally, any errors outputted by code ran in the source pane will be detailed in the console, allowing you to troubleshoot and debug.</li>
<li>
<strong>Environment and history pane</strong>: this pane, in the upper-right, displays information about the current R environment and command history. Perhaps more important, it displays the information of all the R-created objects currently stored in your computer’s memory including data sets, vectors, lists, etc.</li>
<li>
<strong>Files, plots, packages, and help pane</strong>: in the bottom-right, this pane provides access to numerous RStudio tools and resources including the ability to browse and navigate through the files and folders on your computer and view the output of plots and graphics. As well, the ‘Packages’ tab gives you the ability to manage any R packages that you have installed on your system and to view each packages’ help documentation.</li>
</ol></section><section id="running-code-in-rstudio" class="level3" data-number="2.1.4"><h3 data-number="2.1.4" class="anchored" data-anchor-id="running-code-in-rstudio">
<span class="header-section-number">2.1.4</span> Running Code in RStudio</h3>
<p>To begin writing code in RStudio you first need to open a new R script. To do so, select ‘File -&gt; New File -&gt; R Script.’ A new script tab, titled <code>Untitled 1</code> will open in your RStudio’s source pane. To run a line of code - or multiple lines of code - you can do one of two options:</p>
<ol type="1">
<li>Place your cursor directly at the end of the last line of code, or highlight all the code you wish to run, and press ‘Ctrl + Enter’ (Windows) or ‘Command + Enter’ (Mac).</li>
<li>Place your cursor directly at the end of the last line of code, or highlight all the code you wish to run, and then use your mouse to click the ‘Run’ button in the source pane’s toolbar.</li>
</ol>
<p>As a working example, let’s do a simple addition problem within the the source pane:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/example-code-source-pane_3a31213f16449bac6a5b49719099ad83">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After following one of the two above options for running the addition problem, the output in your console should appear like below:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/rstudio-console-output_fd08af15a691bb175dc46497f01164f2">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/example_console_output.jpg" style="width:95.0%;height:95.0%" class="figure-img"></p>
<figcaption class="figure-caption">Example RStudio Console Output</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to notice the <code>&gt;</code> after the output in the console. That indicates that the coding process has completely run and RStudio is ready to run the next task that you submit. If you have an error in your code, you will notice that the <code>&gt;</code> is replaced by what my students refer to as the ‘hanging plus sign’, <code>+</code>.</p>
<p>You receive the <code>+</code> sign when RStudio is expecting a continuation of the code. Several issues can cause this to happen, including forgetting to provide an equal number of opening and closing parenthesis or mistakenly including a pipe, <code>%&gt;%</code>, after the last line of code.</p>
<p>In any case, when you see the <code>+</code> in the console, simply use your mouse to click within the console and hit your keyboard’s escape key. Doing so exits the prompt and resets the console to include the <code>&gt;</code> symbol.</p>
</div>
</div>
</section></section><section id="installing-and-loading-necessary-packages" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="installing-and-loading-necessary-packages">
<span class="header-section-number">2.2</span> Installing and Loading Necessary Packages</h2>
<p>Installing and loading packages is an important part of working with RStudio, as they provide additional functionality that allow you to more efficiently conduct data analysis and/or modeling. Several packages are widely used through this book, including the ever-important <code>tidyverse</code>, the <code>nflverse</code> family of packages to retrieve NFL statistics and data, and many others such as <code>tidymodels</code> when we tackle building and testing advanced models in Chapter 5.</p>
<p>To begin, let’s install both <code>tidyverse</code> and <code>nflverse</code>. In your source pane, you can install a package by using the <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> function. To complete the code, you simply supply the package name within quotation marks.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/installing-packages_4ef1f6180be6afb0feb303c528ca2412">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"nflverse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running the code, your console pane will output what is going on “behind the scenes.” When complete, you will again see the <code>&gt;</code> symbol within the console. At this point, you are able to load the packages you just installed.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/loading-installed-packages_a048b658d84f6fa2791765fc5a0eef2d">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://nflverse.nflverse.com/">nflverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="the-tidyverse-and-its-verbs" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="the-tidyverse-and-its-verbs">
<span class="header-section-number">2.3</span> The <code>tidyverse</code> and Its Verbs</h2>
<p>The <code>tidyverse</code>, now installed and loaded within RStudio, is a collection of R packages designed for data manipulation, visualization, and analysis. It was developed by Hadley Wickham, the Chief Scientist at Posit, and a varied team of contributors. The goal of the <code>tidyverse</code> is to provide a consistent, easy-to-understand set of functions and syntax for working with data in R.</p>
<p>The core principle of the <code>tidyverse</code> is “tidy data,” which is the development team’s belief in creating a standard way of organizing data sets. To that end, a “tidy” data set is one that is comprised of observations (rows) and variables (columns) with each variable being a distinct piece of information and each observation being a unit of analysis.</p>
<p>Installing and loading the <code>tidyverse</code> results eight of the core packages automatically being loaded and ready to use:</p>
<ol type="1">
<li>
<strong>dplyr</strong><strong>:</strong> “dplyr provides a grammar of data manipulation, providing a consistent set of verbs that solve the most common data manipulation challenges.”</li>
<li>
<strong>tidyr</strong><strong>:</strong> “tidyr provides a set of functions that help you get to tidy data. Tidy data is data with a consistent form: in brief, every variable goes in a column, and every column is a variable.”</li>
<li>
<strong>readr</strong><strong>:</strong> “readr provides a fast and friendly way to read rectangular data (like csv, tsv, and fwf). It is deigned to flexibly parse many types of data found in the wild, while still cleanly failing when data unexpectedly changes.”</li>
<li>
<strong>purrr</strong><strong>:</strong> “purrr enhances R’s functional programming (FP) toolkit by providing a complete and consistent set of tools for working with functions and vectors. Once you master the basic concepts, purrr allows you to replace many for loops with code that is easier to write and more expressive.”</li>
<li>
<strong>tibble</strong>: “tibble is a modern re-imagining of the data frame, keeping what time has proven to be effective, and throwing out what it has not. Tibbles are data.frames that are lazy and surly; they do less and complain more forcing you to confront problems earlier, typically leading to cleaner, more expressive code.”</li>
<li>
<strong>stringr</strong><strong>:</strong> “stringr provides a cohesive set of functions designed to make working with strings as easy as possible. It is built on top of stringi, which uses the ICU C library to provide fast, correct implementations of common string manipulations.”</li>
<li>
<strong>forcats</strong><strong>:</strong> “forcats provides a suite of useful tools that solve common problems with factors. R uses factors to handle categorical variables, variables that have a fixed and known set of possible values.”</li>
<li>
<strong>ggplot2</strong><strong>:</strong> “ggplot2 is a system for declaratively creating graphics, based on The Grammar of Graphics. You provide the data, tell ggplot2 how to map the variables to aesthetics, what graphical primitives to use, and it takes care of the details” <span class="citation" data-cites="tidyverse">(<a href="06-nfl-references.html#ref-tidyverse" role="doc-biblioref">Wickham, 2022</a>)</span>.</li>
</ol>
<p>Aside from the core eight packages, the <code>tidyverse</code> will also install a multiple of other packages such as <code>rvest</code> (for web scraping), <code>readxl</code> (for reading Excel sheets in the RStudio environment), <code>lubridate</code> (a very powerful tool for working with times and dates), and <code>magrittr</code> (the package that provides the pipe <code>%&gt;%</code>). As well, prior versions of the <code>tidyverse</code> utilized the <code>modelr</code> package. Modeling is now handled in the <code>tidyverse</code> by the <code>tidymodels</code> package.</p>
</section><section id="the-flow-of-the-tidyverse" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="the-flow-of-the-tidyverse">
<span class="header-section-number">2.4</span> The Flow of the <code>tidyverse</code>
</h2>
<p>The underlying design of coding in the <code>tidyverse</code>, aside from the <code>dplyr</code> verbs, are both the assignment statement (<code>&lt;-</code>) and the pipe (<code>%&gt;%</code>). Please note, as mentioned in the book’s Preface, that I still use the pipe (<code>%&gt;%</code>) that is part of the <code>magrittr</code> package and not the native pipe operator (<code>|&gt;</code>) included in the 4.1 release of R. The choice of pipe operator you use is your decision to make, as either will work seamlessly within the examples and activities provided in this book.</p>
<p>As I explain to my Sports Analytics students, the language and flow of the <code>tidyverse</code> can seem like a foreign language at first. But, it is important that you stick with it because, sooner rather than later, the light bulb above your head will go off. Before detailing the in’s and out’s of the <code>tidyverse</code> in the below section, let’s first dissect an example of the <code>tidyverse</code> workflow.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/example-tidyverse_5221098ecc8d0f7be7ee56bd5d98596a">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"PHI"</span> <span class="op">&amp;</span> <span class="va">rush</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The given example involves multiple iterations of the <code>tidyverse</code> paradigm. At the outset of my Sport Analytics course, when introducing the concepts of the <code>tidyverse</code>, I emphasize that it is possible to “talk your way through” the process from the beginning to your end goal (especially once you have you have a more comprehensive understanding of the <code>dplyr</code> verbs, which are expounded upon in the subsequent section). The following stepwise method illustrates this using the above example of code:</p>
<ol type="1">
<li>We first create a data set, denoted by <code>pbp</code>, by utilizing the <code>load_pbp</code> function from the <code>nflreadr</code> package. To talk through this, you can say “<code>pbp</code>is an copy of <code>nflreadr::load_pbp(2022)</code>.” While R purists may laugh at teaching the <code>tidyverse</code> in such language, it does indeed work. Going forward, the assignment operator (<code>&lt;-</code>) simply implies that “<em>something is</em>.” In this case, our <code>pbp</code> data frame <em>is</em> the container for the play-by-play data we are collecting from <code>nflreadr</code>.</li>
<li>We then move into our first pipe operator (<code>%&gt;%</code>). Again, R language purist will likely develop a eye twitch upon reading this, but I explain to my students that the pipe operator serves as a <em>“… and then”</em> command. In terms of the “talk it out” method above, the flow would be: “<code>pbp</code> is a copy of <code>nflreadr::load_pbp(2022)</code> and then …”</li>
<li>After the pipe operator (or the first “and then …” command), we move into our first <code>dplyr</code> verb. In this case, we are using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb to select just the Philadelphia Eagles as the offensive team and just offensive plays that are rush attempts. With another pipe operator, we are including a second “<em>… and then”</em> command.</li>
<li>To finish the example, we are grouping by each individual rusher on the Eagles “<em>and then”</em> summarize the average success rate for each rusher.</li>
</ol>
<p><strong>To put it together, “talking it out” from beginning to end results in:</strong></p>
<p>“First, create a data set called <code>pbp</code> that is a copy of <code>nflreadr::load_pbp(2022)</code> <em>and then</em> <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> for all instances where the <code>posteam</code> is <code>PHI</code> and <code>rush == 1</code> <em>and then</em> <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> each individual rusher, <em>and then</em> summarize the average success rate for each rusher into a new column titled <code>success_rate</code>.”</p>
<p>To showcase this visually, the “talking through” method is inputted into the example code below:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/talk-through-it-method_d4d27fd973aee89fe35e985cd6e78729">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pbp <span class="ot">&lt;-</span> <span class="st">"is"</span> nflreadr<span class="sc">::</span><span class="fu">load_pbp</span>(<span class="dv">2022</span>) <span class="sc">%&gt;%</span> <span class="st">"... and then"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(posteam <span class="sc">==</span> <span class="st">"PHI"</span> <span class="sc">&amp;</span> rush <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="st">"... and then"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rusher) <span class="sc">%&gt;%</span> <span class="st">"... and then"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">success_rate =</span> <span class="fu">mean</span>(success))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="working-with-nfl-data-and-the-dplyr-verbs" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="working-with-nfl-data-and-the-dplyr-verbs">
<span class="header-section-number">2.5</span> Working With NFL Data and the <code>dplyr</code> Verbs</h2>
<p>Of the packages nestled within the <code>tidyverse</code>, <code>dplyr</code> is perhaps the most important in terms of wrangling and cleaning data. As mentioned above, <code>dplyr</code> is a powerful tool for data manipulation in R as it provides a key set of functions, known as verbs, that are designed to be easy to use and understand. The verbs can be used to filter, group, summarize, rearrange, and transform all types of data sets. For those just starting their NFL analytics endeavors in the R programming language, the following four <code>dplyr</code> verbs are perhaps the most important. Specific examples of working with these verbs, as well as others, follow below.</p>
<ol type="1">
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>: the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb allows you to subset data based on certain criteria. For example, you can use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to keep only those rows in a data set where a certain variable meets a certain conditions (ie., more than 100 completed passes). Moreover, the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb can be used in conjunction with logical operators such as <code>&amp;</code> and <code>|</code> to create more complex criteria.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>: the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb allows you to group a data set by one or more variables. It is a useful tool when you want to perform an operation on each group, such as calculating a summary statistic (ie, intended air yards per quarterback) or when creating a plot.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>: the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb allows you to reduce a data set to a single summary value. The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb is often used in conjunction with the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> function, allowing you to group the data by one or more variables. The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb allows for a wide range of summary statistics, including means, medians, standard deviations, and more. You can also use it to calculate custom summary statistics.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>: the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verbs allows you to create new variables within your data while also preserving existing ones.</li>
</ol>
<section id="nfl-data-and-the-filter-verb" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="nfl-data-and-the-filter-verb">
<span class="header-section-number">2.5.1</span> NFL Data and the <code>filter()</code> verb</h3>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb allows you to extract specific rows from your dataset based on one, or multiple, supplied conditions. The conditions are supplied to the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb by using logical operators, listed in the below table, that ultimately evaluate to either <code>TRUE</code> or <code>FALSE</code> in each row of the dataset. The <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> process returns a data set that includes only those rows that meet the specified conditions.</p>
<center>
<p></p>
<table class="table">
<thead><tr class="header">
<th style="text-align: center;">Logical Operator</th>
<th style="text-align: center;">Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>==</code></td>
<td style="text-align: center;">equal to</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>!=</code></td>
<td style="text-align: center;">not equal to</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&lt;</code></td>
<td style="text-align: center;">less than</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&lt;=</code></td>
<td style="text-align: center;">less than or equal to</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>&gt;</code></td>
<td style="text-align: center;">greater than</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&gt;=</code></td>
<td style="text-align: center;">greater than or equal to</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>!</code></td>
<td style="text-align: center;">not</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>&amp;</code></td>
<td style="text-align: center;">and</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>|</code></td>
<td style="text-align: center;">or</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>%in%</code></td>
<td style="text-align: center;">includes</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code><a href="https://rdrr.io/r/base/c.html">c()</a></code></td>
<td style="text-align: center;">used to combine arguments into a vector</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>is.na</code></td>
<td style="text-align: center;">checks for missing values</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>!is.na</code></td>
<td style="text-align: center;">is not missing specific values</td>
</tr>
</tbody>
</table>
</center>
<p>In order to work through specific examples of the above logical operators, we will use 2022 play-by-play data from <code>nflreadr</code>. To begin, let’s read in the data:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please note that a more detailed overview of reading in <code>nflreadr</code> data is provided in Chapter 3. For the purposes of learning about the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb, please make sure you have both the <code>tidyverse</code> and <code>nflreadr</code> loaded by running the following:</p>
<p><code>library(tidyverse</code>)<br><code><a href="https://nflreadr.nflverse.com">library(nflreadr)</a></code></p>
<p>If you have difficult with the above step, please see the <a href="#installing-and-loading-necessary-packages">Installing and Loading Necessary Packages</a> section above.</p>
</div>
</div>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/loading-in-filter-data_a36f73e9d9475898784514c18dee2f54">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running the above code, you will have a data set titled <code>pbp</code> placed into your RStudio environment consisting of 50,147 observations over 372 variables. With the data set loaded, let’s create a new data set titled <code>ne_offense</code> that contains <em>only those plays where the New England Patriots</em> <em>are the offensive team</em>.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/ne-offense-filter_992a5c2c3850fa232af41ffa315e96aa">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"NE"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ne_offense</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,323 x 372
   play_id game_id   old_game_id home_team away_team season_type  week
     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;
 1      44 2022_01_~ 2022091106  MIA       NE        REG             1
 2      59 2022_01_~ 2022091106  MIA       NE        REG             1
 3      83 2022_01_~ 2022091106  MIA       NE        REG             1
 4     109 2022_01_~ 2022091106  MIA       NE        REG             1
 5     130 2022_01_~ 2022091106  MIA       NE        REG             1
 6     154 2022_01_~ 2022091106  MIA       NE        REG             1
 7     175 2022_01_~ 2022091106  MIA       NE        REG             1
 8     196 2022_01_~ 2022091106  MIA       NE        REG             1
 9     236 2022_01_~ 2022091106  MIA       NE        REG             1
10     571 2022_01_~ 2022091106  MIA       NE        REG             1
# i 1,313 more rows
# i 365 more variables: posteam &lt;chr&gt;, posteam_type &lt;chr&gt;, ...</code></pre>
</div>
</div>
<p>The output shows that the <code>posteam</code> variable contains only <code>NE</code>, which is the abbreviation for the New England Patriots in the <code>nflreadr</code> play-by-play data. In the code that produced <code>ne_offense</code>, <strong>it is important to notice that:</strong></p>
<ol type="1">
<li>the “equal to” logical operator consist of <em>TWO</em> equal signs, not one.</li>
<li>the team abbreviation (<code>NE</code>) is in quotation marks.</li>
</ol>
<p>In the first, a single equal sign (<code>=</code>) can be used as a synonym for assignment (<code>&lt;-</code>) but is most often used when passing values into functions. To avoid confusion with this possibility, <strong>the test for equality when using <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code></strong> <strong>is always <code>==</code></strong>.</p>
<p>In the second, you must use quotation marks around the character-based value you are placing into the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb because, if not, R will interpret <code>posteam</code> incorrectly and ultimately generate an error. On the other hand, you <em>do not</em>&nbsp;need to include quotation marks if you are filtering out numeric-based variables. Below are incorrect and correct examples of both:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/correct-incorrect-filter_cdfc07cdca2da65f07c369846d0b06a5">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="va">NE</span><span class="op">)</span> <span class="co">#this is incorrect.</span></span>
<span>                        <span class="co">##Character values must be in quotation marks.</span></span>
<span></span>
<span><span class="va">ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"NE"</span><span class="op">)</span> <span class="co">#this is correct for character values.</span></span>
<span></span>
<span><span class="va">ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="st">"5"</span><span class="op">)</span> <span class="co">#this is incorrect.</span></span>
<span>                           <span class="co">#Numeric values do not need quotation marks.</span></span>
<span></span>
<span><span class="va">ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">5</span><span class="op">)</span> <span class="co">#this is correct for numeric values.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How do we approach the logical operators if we want to retrieve every offensive team in the <code>pbp</code> data <em>except</em> for New England? In that case, we can use the “not equal to” (<code>!=</code>) operator:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/not-ne-offense_219a73d5adea7ad47954927e148fc1bf">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">not_ne_offense</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">!=</span> <span class="st">"NE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting data set titled <code>not_ne_offense</code> will still include all 372 variables housed within the <code>nflreadr</code> play-by-play data, but will not include any row in which New England is the offensive (<code>posteam</code>) team.</p>
<p><strong>Continuing with examples, how do we use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code></strong> <strong>verb on multiple teams at once?</strong> For instance, let’s use the above filtering process for offensive teams but only retrieve information from the play-by-play data for the four teams that comprise the AFC East (Buffalo Bills, Miami Dolphins, New England Patriots, and the New York Jets). There are, in fact, two logical operators that can produce the results we are looking for: the “or” logical operator (<code>|</code>) or by using the “includes” logical operator (<code>%in%</code>) combined with the “concatenate” operator (<code><a href="https://rdrr.io/r/base/c.html">c()</a></code>). Let’s start with using the “or” operator.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/afc-east-filter_eefd84851d1ede4761ce81c44c65e4a8">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">afc_east</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"NE"</span> <span class="op">|</span> <span class="va">posteam</span> <span class="op">==</span> <span class="st">"MIA"</span></span>
<span>         <span class="op">|</span> <span class="va">posteam</span> <span class="op">==</span> <span class="st">"NYJ"</span> <span class="op">|</span> <span class="va">posteam</span> <span class="op">==</span> <span class="st">"BUF"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By using the <code>|</code> logical operator, which translates to the word “or”, we can string together for separate filters for <code>posteam</code> within the play-by-platy data. That said, it probably seems odd to have to include the <code>posteam</code> argument four different times, rather than being able to do this:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/afc-east-filter-error_bda7ffd14c98cc6368da5834caacc883">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">afc_east</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op">==</span> <span class="st">"NE"</span> <span class="op">|</span> <span class="st">"MIA"</span> <span class="op">|</span> <span class="st">"NYJ"</span> <span class="op">|</span> <span class="st">"BUF"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While the above example logically makes sense (verbally saying “<code>posteam</code> equals NE or MIA or NYJ or BUF”), it unfortunately results in an error. To that end, if you’d rather avoid the need to type <code>posteam</code> four different times, as in the above example, you can switch to using the <code>%in%</code> operator combined with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. It is possible to combine just <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> and the <code>%in%</code> operator to retrieve one specific team. But, as in the above example where, we will receive an error if we try to do it for multiple teams without including the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> operator, as such:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/afc-east-with-in-c_3a1db9cded62150f069123492fde3642">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">afc_east</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NE"</span>, <span class="st">"MIA"</span>, <span class="st">"NYJ"</span>, <span class="st">"BUF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">afc_east</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,625 x 372
   play_id game_id   old_game_id home_team away_team season_type  week
     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;
 1      43 2022_01_~ 2022091107  NYJ       BAL       REG             1
 2      68 2022_01_~ 2022091107  NYJ       BAL       REG             1
 3      89 2022_01_~ 2022091107  NYJ       BAL       REG             1
 4     115 2022_01_~ 2022091107  NYJ       BAL       REG             1
 5     136 2022_01_~ 2022091107  NYJ       BAL       REG             1
 6     172 2022_01_~ 2022091107  NYJ       BAL       REG             1
 7     391 2022_01_~ 2022091107  NYJ       BAL       REG             1
 8     412 2022_01_~ 2022091107  NYJ       BAL       REG             1
 9     436 2022_01_~ 2022091107  NYJ       BAL       REG             1
10     469 2022_01_~ 2022091107  NYJ       BAL       REG             1
# i 5,615 more rows
# i 365 more variables: posteam &lt;chr&gt;, posteam_type &lt;chr&gt;, ...</code></pre>
</div>
</div>
<p>The above approach is a simplified version of first creating a vector of the team abbreviations and then passing that into the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> argument. For example, we can create the following vector that appears in the “Values” area of your RStudio environment, and then use that to retrieve the same results in did in the above code:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/filter-with-vector_e5a2cb46f101b4c7f63726c6160ce5b2">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">afc_east_teams_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NE"</span>, <span class="st">"MIA"</span>, <span class="st">"NYJ"</span>, <span class="st">"BUF"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">afc_east</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">posteam</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">afc_east_teams_vector</span><span class="op">)</span></span>
<span></span>
<span><span class="va">afc_east_teams_vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "NE"  "MIA" "NYJ" "BUF"</code></pre>
</div>
</div>
<p>In other cases, we may need to do the opposite of above - that is, select all teams <em>except</em> for specific ones. For example, using data from <a href="pff.com">Pro Football Focus</a> regarding a quarterback’s average time to throw, let’s determine how to <em>remove</em> all AFC North teams (Pittsburgh, Cleveland, Baltimore, and Cincinnati) from the data set while leaving all other teams intact. Such a procedure is necessary, for example, if we wanted to explore the average time to throw for the combined AFC North teams against the rest of the NFL.</p>
<p>We cannot leave the data as is and find the averages outright. We must remove the AFC North teams in order to avoid “baking them into” the league-wide average, thus skewing the results of our analysis. To complete this process, we turn to the <code>!</code> (“is not”) logical operator.</p>
<p>To begin, we will use the <code>vroom</code> package to read in the data. Let’s load the ‘vroom’ package before using it.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/loading-installed-vroom_c20beed9a4fe7849a750334953b93f50">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vroom.r-lib.org">vroom</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/add-pff-pocket-data_4da9abb357571c40412990926d49637b">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">time_in_pocket</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/qb-tip"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/show-time-in-pocket_4f82b72aebd9f43560cae3640ec12758">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 x 5
   player       position team_name player_game_count avg_time_to_throw
   &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;             &lt;dbl&gt;
 1 Patrick Mah~ QB       KC                       20              2.85
 2 Tom Brady    QB       TB                       18              2.31
 3 Justin Herb~ QB       LAC                      18              2.75
 4 Joe Burrow   QB       CIN                      19              2.51
 5 Josh Allen   QB       BUF                      18              2.92
 6 Kirk Cousins QB       MIN                      18              2.7 
 7 Trevor Lawr~ QB       JAX                      19              2.51
 8 Geno Smith   QB       SEA                      18              2.79
 9 Daniel Jones QB       NYG                      18              3.03
10 Jalen Hurts  QB       PHI                      18              2.86
# i 20 more rows</code></pre>
</div>
</div>
<p>The structure and organization of the data is quite similar to the data sets we worked with in our above examples, despite coming from a different source (PFF vs.&nbsp;<code>nflreadr</code>). Our <code>time_in_pocket</code> data includes a quarterback’s name on each row with his corresponding <code>team</code>, <code>player_game_count</code>, and <code>avg_time_to_throw</code>. Again, we are seeking to compare the average time to release - combined - for the AFC North against the rest of the NFL. In order to avoid skewing the results by “baking in data” (that is, not removing AFC North teams prior to finding the NFL average), we can use the <code>!</code> logical operator to remove all four teams at once (as oppose to structuring the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to include four separate <code>team_name !=</code> for all four different AFC North teams.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/removing-afc-north-teams_c4e934edf79e7b5602f2d1e88367d3a1">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">time_in_pocket_no_afcn</span> <span class="op">&lt;-</span> <span class="va">time_in_pocket</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">team_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PIT"</span>, <span class="st">"BAL"</span>, <span class="st">"CIN"</span>, <span class="st">"CLE"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_in_pocket_no_afcn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 26 x 5
   player       position team_name player_game_count avg_time_to_throw
   &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;                 &lt;dbl&gt;             &lt;dbl&gt;
 1 Patrick Mah~ QB       KC                       20              2.85
 2 Tom Brady    QB       TB                       18              2.31
 3 Justin Herb~ QB       LAC                      18              2.75
 4 Josh Allen   QB       BUF                      18              2.92
 5 Kirk Cousins QB       MIN                      18              2.7 
 6 Trevor Lawr~ QB       JAX                      19              2.51
 7 Geno Smith   QB       SEA                      18              2.79
 8 Daniel Jones QB       NYG                      18              3.03
 9 Jalen Hurts  QB       PHI                      18              2.86
10 Jared Goff   QB       DET                      17              2.7 
# i 16 more rows</code></pre>
</div>
</div>
<p>With Pittsburgh, Baltimore, Cincinnati, and Cleveland removed from the data set, we can - for the sake of completing the analysis - take our new <code>time_in_pocket_afcn</code> data set and find the league-wide average for <code>avg_time_to_throw</code>.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/time-to-throw-analysis_6a281f0fa1dce41ee30adc334686260b">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">time_in_pocket_no_afcn</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>combined_average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_time_to_throw</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
  combined_average
             &lt;dbl&gt;
1             2.76</code></pre>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">time_in_pocket</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">team_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PIT"</span>, <span class="st">"BAL"</span>, <span class="st">"CIN"</span>, <span class="st">"CLE"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>combined_average <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_time_to_throw</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
  combined_average
             &lt;dbl&gt;
1             2.89</code></pre>
</div>
</div>
<p>The AFC North quarterbacks had an average time to throw of 2.89 seconds while the rest of the NFL averaged 2.76 seconds, meaning the AFC North QBs released the ball, on average, 0.13 seconds slower than the rest of the quarterbacks in the league.</p>
<p>So far, all our <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> operations have include just one logical operator, or multiple values built into one operator using the <code>%in%</code> option. However, because of the structure of the logical operators, we are able to construct a single <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> combined with various operator requests. For example, let’s gather only those rows that fit the following specifications:</p>
<ol type="1">
<li>that play occurs on 2nd down.</li>
<li>the play must be a pass play.</li>
<li>the play must include a charted QB hit.</li>
<li>the play must result in a complete pass.</li>
<li>the pass must have an air yards amount that is greater than or equal to the yards to go.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Compiling the above <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> requires knowledge of the variable names within <code>nflreadr</code> play-by-play data. This is covered in Chapter 3.</p>
<p>That said, it is important to point out that many of the above variables have data values that are structured in binary - that is, the value is either 1 or 0.</p>
<p>In the above list, the <code>qb_hit</code> variable is binary. A play <em>with</em> a QB hit is denoted by the inclusion of a numeric <code>1</code> in the data, while the inclusion of a numeric <code>0</code> indicates that a QB hit did not occur.</p>
</div>
</div>
<p>Building the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> based on the above specifications requires the use of both character and numeric values:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/filter-for-qb-hits_cbf2b3171bd2d864cda87f854166ddde">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">multiple_filters</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">down</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">play_type</span> <span class="op">==</span> <span class="st">"pass"</span> <span class="op">&amp;</span></span>
<span>           <span class="va">qb_hit</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>           <span class="va">complete_pass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> </span>
<span>           <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="va">ydstogo</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting data set, <code>multiple_filters</code>, indicates that exactly 105 such instances took place during the 2002 NFL season.</p>
<p>Lastly, in some instances, it is necessary to use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to remove rows that may provide you with incorrect information if include. To showcase this, it is necessary to also include the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb, which is covered in greater detail in the following two section. For example, let’s gather information from the play-by-play data that will provide the total amount of yards per scrimmage - combined - for the 2022 regular season. Using our knowledge from the prior example, we can write code that first uses the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb to retrieve just those rows that took place during the regular season and then uses the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb to distill the information down to the singular, combined total. In the example below, please note the use of <code>na.rm = TRUE</code>. When completing computation operations within the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb, it is often necessary to include <code>na.rm = TRUE</code> in order to drop any missing values in the data. This is especially important when using the <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> calculation, as any missing data will result in <code>NA</code> values being returned.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/nfl-total-scrimmage-yards_b539a161c37ae0a9c87cb5be3cf0871b">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">total_yards</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_yards</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
   yards
   &lt;dbl&gt;
1 184444</code></pre>
</div>
</div>
<p>How many total scrimmage yards did NFL teams earn during the 2022 NFL regular season? According to the results from our above code, the answer is 184,444. However, that is incorrect.</p>
<p>The right answer, in fact, is 184,332 total scrimmage yards. How did the results of our above coding come up 112 shorts of the correct answer (as provided by the <a href="https://www.pro-football-reference.com/years/2022/#all_team_stats">2022 Team Stats page on Pro Football Reference</a>)?</p>
<p>The difference is the result of the above code including all plays, including 2-point conversion attempts. Because a 2-point conversion is technically considered an extra point attempt - not a play from scrimmage or an official down - no player stats are officially record for the play. We can verify this is the case by using the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb to include only those rows that include regular-season games and those plays that do not include information pertaining to <code>down</code>:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/verify-two-points_fa7c3a74b9f5ca679c8b073d2cfaf73b">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">two_points</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            total_yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">two_points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 2
  total total_yards
  &lt;int&gt;       &lt;dbl&gt;
1  8137         112</code></pre>
</div>
</div>
<p>The results show that exactly 112 scrimmage yards were gained on places missing <code>down</code> information. There was, of course, not 8,137 2-point conversion attempts during the 2022 regular season. There are many other instances within the data that do not include information for <code>down</code>, including: kickoffs, extra points, time outs, the end of a quarter, etc. We can be more specific with our <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> argument in the above code to include only the binary argument for the <code>two_point_attempt</code> variable:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/actual-two-point-attempts_ce45a3a1660f6026fe47560b713a5c9a">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">two_points_true</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span> <span class="op">&amp;</span> <span class="va">two_point_attempt</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            total_yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">two_points_true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 2
  total total_yards
  &lt;int&gt;       &lt;dbl&gt;
1   119         112</code></pre>
</div>
</div>
<p>By altering the `<code>is.na(down)</code> argument to the binary indicator for <code>two_point_attempt</code>, we see that there were 119 2-point conversion attempts in the 2022 regular season while maintain the correct 112 yards that explains our difference from above. To account for our new-found knowledge that we must remove 2-point conversions to calculate the correct amount of total scrimmage yards, we can again use the <code>!is.na()</code> operator (where <code>!is.na()</code> means “is not missing this specific variable) to remove all rows that do not include information pertaining to <code>down</code>:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/total-scrimmage-correct_6e59a4bedf805b7b9f38c8d2241d6978">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">total_yards_correct</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>yards <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_gained</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_yards_correct</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
   yards
   &lt;dbl&gt;
1 184332</code></pre>
</div>
</div>
<p>By filtering out any row that does not include the <code>down</code> for a given play, we correctly calculated the total amount of scrimmage yards - 184,332 - for the 2022 NFL regular season.</p>
</section><section id="nfl-data-and-the-group_by-verb" class="level3" data-number="2.5.2"><h3 data-number="2.5.2" class="anchored" data-anchor-id="nfl-data-and-the-group_by-verb">
<span class="header-section-number">2.5.2</span> NFL Data and the <code>group_by()</code> verb</h3>
<p>As mentioned above, the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb allows you to group data by one or more specific variables in order to retrieve, among other actions, summary statistics. To showcase how <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> is used within the <code>nflverse</code> data, let’s first gather the 2022 regular season statistics and then use the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb to get the average success rate on rushing plays.</p>
<p>As well, we immediately make use of the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function to sort the data : (1.) we first instruct to <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> the data to include just those instances where the <code>play_type</code> equals <code>run</code>, (2.) we then say it must also be <code>play == 1</code>, meaning there was no penalty or other interruption that “cancelled out” the play, and (3.) we lastly pass the argument that the <code>down</code> cannot be missing by using <code>!is.na</code> as a missing down is indicative of a two-point conversion attempt.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/success-rate-without-group_3b6ba446ec5f77730b5d324d055fa174">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rushing_success_ungrouped</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"run"</span> <span class="op">&amp;</span> <span class="va">play</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rushing_success_ungrouped</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 1
  success_rate
         &lt;dbl&gt;
1        0.431</code></pre>
</div>
</div>
<p>Without including the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb within the above code, the output is the average success rate for rushing plays for all 32 NFL teams, wherein success rate is the percentage of rushing plays that resulted in an EPA above zero. In this case, approximately 43% of NFL rushes had a positive success rate.</p>
<p>That said, we are interested in examining the success rate by team, not league-wide average. To do so, we add the <code>posteam</code> variable into the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/success-rate-with-grouping_eecc74d81a66a36e65f033cbdb98b154">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rushing_success_grouped</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"run"</span> <span class="op">&amp;</span> <span class="va">play</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">success_rate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rushing_success_grouped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 2
   posteam success_rate
   &lt;chr&gt;          &lt;dbl&gt;
 1 PHI            0.526
 2 BUF            0.488
 3 BAL            0.478
 4 GB             0.476
 5 PIT            0.470
 6 ATL            0.463
 7 KC             0.459
 8 NYG            0.454
 9 CIN            0.454
10 LV             0.449</code></pre>
</div>
</div>
<p>In the above example, we have added the offensive team into the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb, while also arranging the data in descending order by <code>success_rate</code>, and then used <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> to gather just the ten teams with the highest rushing success rate. The Philadelphia Eagles led the NFL in rushing success rate during the 2022 NFL regular season at 52.3%. By removing the <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> function in the above example, we can see that Tampa Bay maintained the worst rushing success rate in the league at 37.3%.</p>
<p>While determining the rushing success rate of teams is interesting, we can also determine the same metric for individual running backs as well. To do so, we simply replace the variable in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb. In the below example, we replace the <code>posteam</code> variable with the <code>rusher</code> variable to see which running backs have the highest success rate.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/running-back-success_6dc4183eca78ade7bdb5584750381dc3">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">running_back_success</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"run"</span> <span class="op">&amp;</span> <span class="va">play</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">success_rate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">running_back_success</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 2
   rusher      success_rate
   &lt;chr&gt;              &lt;dbl&gt;
 1 A.Davis                1
 2 B.Aiyuk                1
 3 B.Allen                1
 4 B.Skowronek            1
 5 C.Kmet                 1
 6 C.Sutton               1
 7 C.Wilson               1
 8 D.Bellinger            1
 9 D.Brown                1
10 D.Gray                 1</code></pre>
</div>
</div>
<p>The output, unfortunately, is not all that helpful. Because we did not use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb to stipulate a minimum number of rushing attempts, the output is saying that - for example, Daniel Bellinger, a tight end, was among the most successful rushers in the league with a 100% rushing success rate. To correct this, we must add a second metric to our <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb (we will call it <code>n_rushes</code>) and then use the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb afterwards to include a minimum number of rushes required to be included in the final output.</p>
<p>As well, we will provide an additional argument in the first <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb that stops the output from including any rushing attempt that does not include the running back’s name. The <code>n_rushes()</code> in the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb allows us to now include the number of attempts, per individual rusher, that fall within the first <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> parameter. Afterwards, we include a second <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> argument to include just those rushers with at least 200 attempts.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/running-back-success-min_d7342affe7f692e320f623d4c76ba261">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">running_back_success_min</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"run"</span> <span class="op">&amp;</span> <span class="va">play</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span></span>
<span>           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>success_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span>,</span>
<span>            n_rushes <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_rushes</span> <span class="op">&gt;=</span> <span class="fl">200</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">success_rate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">running_back_success_min</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 3
   rusher      success_rate n_rushes
   &lt;chr&gt;              &lt;dbl&gt;    &lt;int&gt;
 1 M.Sanders          0.483      294
 2 I.Pacheco          0.469      207
 3 A.Jones            0.465      213
 4 J.Jacobs           0.444      340
 5 N.Chubb            0.434      302
 6 T.Allgeier         0.429      210
 7 Ja.Williams        0.427      262
 8 T.Etienne          0.424      250
 9 J.Mixon            0.422      249
10 B.Robinson         0.420      205</code></pre>
</div>
</div>
<p>Unsurprisingly, Miles Sanders - a running back for the Eagles , who lead the NFL in team success rate - is the leader in rushing success among individual players with 49% of his attempts gaining positive EPA.</p>
<p>Much like the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb, we are able to supply multiple arguments within one <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb. This is necessary, for example, when you want to examine results over the course of multiple seasons. Let’s explore this by determining each team’s yards after catch between 2010 and 2022. To start, we will retrieve all NFL play-by-play data from those seasons.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Loading in multiple seasons of play-by-play data can be taxing on your computer’s memory. RStudio’s memory usage monitor, located in ‘Environment’ toolbar tell you how much data is currently being stored in memory. As needed, you can click on the usage monitor and select ‘Free Unused Memory’ to purge any data that is no longer also in your ‘Environment.’</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">multiple_seasons</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2010</span><span class="op">:</span><span class="fl">2022</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the data set is loaded, we can think ahead to what is needed in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb. In this case, we are exploring team results on a season basis. Because of this, we will include <em>both</em> <code>posteam</code> and <code>season</code> in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/calculating-yac-group-example_9c997f0268a1847dbb76fbd5bd20d886">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yac_seasons</span> <span class="op">&lt;-</span> <span class="va">multiple_seasons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span> <span class="op">&amp;</span></span>
<span>           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>           <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">yards_after_catch</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">season</span>, <span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total_yac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">yards_after_catch</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="nfl-data-and-the-summarize-verb" class="level3" data-number="2.5.3"><h3 data-number="2.5.3" class="anchored" data-anchor-id="nfl-data-and-the-summarize-verb">
<span class="header-section-number">2.5.3</span> NFL Data and the <code>summarize()</code> verb</h3>
<p>As we’ve seen, the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function can be used to find summary statistics based whichever option we pass to it via the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb. However, it can also be used to create new metrics built off data included in the <code>nflverse</code> play-by-play data.</p>
<p>Let’s examine which teams were the most aggressive on 3rd and short passing attempts during the 2022 season. Of course, determining our definition of both what “short” is on 3rd down and “aggressive” is quite subjective. For the purposes of this example, however, let’s assume that 3rd and short is considered 3rd down with five or less yards to go and that “aggressive” is a quarterback’s air yards being to, at minimum, the first-down marker.</p>
<p>Must like our above examples working with rushing success rate, we begin constructing the metric with the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> argument. In this case, we are filtering for just pass plays, we want the down to equal 3, the yards to go to be equal to or less than 5, we want it to be an official play, and we do not want it to be missing the down information. After the initial <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> process, we include the <code>posteam</code> variable within our <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> verb.</p>
<p>In our <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> section, we are first getting the total number of times each team passed the ball on 3rd down with no more than five yards to go. After, we are creating a new <code>aggressiveness</code> column that counts the number of times a quarterback’s air yards were, at minimum, the required yards for a first down. Next, we create another new column titled <code>percentage</code> that takes <code>aggressiveness</code> and divides it by <code>total</code>.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/team-aggressiveness_48ff0c951f894e386d8fcf221cae5c04">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">team_aggressiveness</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">play_type</span> <span class="op">==</span> <span class="st">"pass"</span> <span class="op">&amp;</span></span>
<span>           <span class="va">down</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">&amp;</span></span>
<span>           <span class="va">ydstogo</span> <span class="op">&lt;=</span> <span class="fl">5</span> <span class="op">&amp;</span></span>
<span>           <span class="va">play</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">posteam</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            aggressiveness <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="va">ydstogo</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            percentage <span class="op">=</span> <span class="va">aggressiveness</span> <span class="op">/</span> <span class="va">total</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">percentage</span><span class="op">)</span></span>
<span></span>
<span><span class="va">team_aggressiveness</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 4
   posteam total aggressiveness percentage
   &lt;chr&gt;   &lt;int&gt;          &lt;int&gt;      &lt;dbl&gt;
 1 LV         60             50      0.833
 2 BUF        61             47      0.770
 3 ARI        58             44      0.759
 4 SF         67             50      0.746
 5 PIT        79             58      0.734
 6 SEA        60             44      0.733
 7 NE         54             39      0.722
 8 TB         92             66      0.717
 9 MIA        62             43      0.694
10 CHI        42             29      0.690</code></pre>
</div>
</div>
<p>The Las Vegas Raiders , based on our definitions, are the most aggressive passing team in the league on 3rd and short as just over 83% of their air yards were at - or past - the required yardage for a first down. On the other end of the spectrum, the New York Giants were the least aggressive team during the 2022 regular season, at 49.1%.</p>
</section><section id="nfl-data-and-the-mutate-verb" class="level3" data-number="2.5.4"><h3 data-number="2.5.4" class="anchored" data-anchor-id="nfl-data-and-the-mutate-verb">
<span class="header-section-number">2.5.4</span> NFL Data and the <code>mutate()</code> verb</h3>
<p>In the our example above working with the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb, our output includes only the information contained in our <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and then whatever information we provided in the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> (such as <code>total</code>, <code>aggressiveness</code>, and <code>percentage</code>).</p>
<p>What if, however, you wanted to create new variables and then <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> those? That is where the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb is used.</p>
<p>As an example, let’s explore individual quarterback’s average completion percentage over expected for specific air yard distances . To start, we can attempt to do this simply by including both <code>passer</code> and <code>air_yards</code> in the <code>group_by</code> verb.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/qb-cpoe-no-mutate_ae6e02e34a2037b41b9fb8e1896deb0d">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airyards_cpoe</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">passer</span>, <span class="va">air_yards</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_cpoe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cpoe</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your output is going to include the <code>avg_cpoe</code> for each quarterback at each and every distance of <code>air_yards</code>. Not only is it difficult to find meaning in, but it would prove to be difficult - if not impossible - to visualize with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>. To correct this issue, we must use the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb.</p>
<p>Rather than <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> the completion percentage over expected for each distance of <code>air_yards</code>, we can use the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb to bundle together a grouping of distances. In the below example, we are using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb to create a new variable titled <code>ay_distance</code> using the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> verb.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/qb-cpoe-mutate_21a60344f92f18a85be4575f3ef3df22">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airyards_cpoe_mutate</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">cpoe</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    ay_distance <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"Negative"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">~</span> <span class="st">"Short"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">air_yards</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"Medium"</span>,</span>
<span>      <span class="va">air_yards</span> <span class="op">&gt;=</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"Deep"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">passer</span>, <span class="va">ay_distance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>avg_cpoe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cpoe</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the <code>air_yards</code> data now binned into four different groupings, we can examine quarterbacks at specific distances.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/qb-cpoe-medium_14c1cd2792ed682b9f0f23abe32506f9">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">airyards_cpoe_mutate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ay_distance</span> <span class="op">==</span> <span class="st">"Medium"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">avg_cpoe</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 82 x 3
# Groups:   passer [82]
   passer     ay_distance avg_cpoe
   &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
 1 A.Brown    Medium        -6.09 
 2 A.Cooper   Medium       -43.1  
 3 A.Dalton   Medium         5.01 
 4 A.Rodgers  Medium         2.02 
 5 B.Allen    Medium        44.5  
 6 B.Hoyer    Medium       -44.0  
 7 B.Mayfield Medium       -15.4  
 8 B.Perkins  Medium         0.266
 9 B.Purdy    Medium         9.72 
10 B.Rypien   Medium        18.0  
# i 72 more rows</code></pre>
</div>
</div>
</section></section><section id="core-skills-for-tidy-data" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="core-skills-for-tidy-data">
<span class="header-section-number">2.6</span> Core Skills for Tidy Data</h2>
<p>With your new understanding of the <code>tidyverse</code> flow in the R programming language, we are now going to hone these core skills by taking a dataset from ingestion through the cleaning and prepping process so that it is prepared for eventual data visualization (which will be done in Chapter 4 of this book). To do so, we are going to use data provided by <a href="https://www.sportsinfosolutions.com/">Sports Info Solutions</a>. Based out of Allentown, Pennsylvania, SIS collects its play-by-play and then does a manual hand-charting process to provide weekly data that covers a vast array of specific occurrences in football (defensive scheme, pre-snap motion, wide receivers formations, offensive personnel, drop type, and more).</p>
<p>In this example, we are going to compare the <code>Boom%</code> and the <code>Bust%</code> for each quarterback in the data, wherein the <code>Boom%</code> correlates to any pass attempt by the quarterback that resulted in an expected points add (EPA) of at least 1 and <code>Bust%</code> is any pass attempt that resulted in an EPA of at least -1. In order to prepare the data for visualization in <code>ggplot</code>, we will:</p>
<ol type="1">
<li>Import and examine the data.</li>
<li>Deal with missing values in the data.</li>
<li>Charge variable types to match what it needed for visualization.</li>
<li>Using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb to correct and create new metrics within the data.</li>
<li>Merging the data with a secondary dataset.</li>
</ol>
<section id="importing-and-conducting-exploratory-data-analysis" class="level3" data-number="2.6.1"><h3 data-number="2.6.1" class="anchored" data-anchor-id="importing-and-conducting-exploratory-data-analysis">
<span class="header-section-number">2.6.1</span> Importing and Conducting Exploratory Data Analysis</h3>
<p>To start, let’s examine data from Sports Info Solutions by reading in the data from this book’s Git repository using the <code>vroom</code> package.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/sis-boom-bust_3617d28a178bb19ddfc352b2e42de94a">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span><span class="st">"http://nfl-book.bradcongelio.com/sis-bb"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using <code>vroom</code> , we are reading in the <code>.csv</code> file into our environment and assigning it the name <code>sis_data</code>. With access to the data, we can begin our exploratory data analysis - the importance of which cannot be understated. The process of EDA results in several key items:</p>
<ol type="1">
<li>EDA helps to identify potential issues in the data set, such as missing or erroneous data, outliers, or inconsistent values - all of which must be addressed prior to further analysis or visualization.</li>
<li>Conducting an EDA allows you to gain a deeper understanding of the distribution, variability, and relationships between all the variables contained in the data set, thus allowing you to make informed decisions on appropriate statistical techniques, models, and visualizations that can best analyze and communicate the data effectively.</li>
<li>The EDA process can help you discover patterns or trends in the data that may be of interest or relevance to your research question, or help you discover to questions to answer.</li>
</ol>
<p>To start the process of EDA on our newly created <code>sis_data</code> dataset, let’s examine the current status of the data set:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/sis-data-eda_846b186b61e6c616bf0acd75e68e2c94">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 x 14
   Season Player          Team       Att `Points Earned` `PE Per Play`
    &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;           &lt;dbl&gt;         &lt;dbl&gt;
 1   2022 Patrick Mahomes Chiefs     648            180.         0.267
 2   2022 Justin Herbert  Chargers   699            138.         0.187
 3   2022 Trevor Lawrence Jaguars    584            123.         0.202
 4   2022 Jared Goff      Lions      587            121.         0.199
 5   2022 Jalen Hurts     Eagles     460            106.         0.213
 6   2022 &lt;NA&gt;            &lt;NA&gt;       439            104.         0.12 
 7   2022 Kirk Cousins    Vikings    643            104.         0.151
 8   2022 Tua Tagovailoa  Dolphins   400            102.         0.243
 9   2022 Joe Burrow      Bengals    606            102.         0.158
10   2022 Josh Allen      Bills      567            100.         0.167
# i 97 more rows
# i 8 more variables: `Points Above Avg` &lt;dbl&gt;, ...</code></pre>
</div>
</div>
<p>The results immediately bring to light several issues in the data:</p>
<ol type="1">
<li>There are several instances of missing data (as indicated by <code>NA</code> values in the 6th row).</li>
<li>Many of the column names are not in <code>tidy</code> format. Specifically, the <code>Boom%</code> and <code>Bust%</code> columns, because of the inclusion of the percentage sign, require the small ticks at either end of the word. The same issue is apparent in <code>Points Earned</code> as it includes a space between the word and, finally, many of the variable names are in full caps.</li>
<li>The <code>Boom%</code> and <code>Bust%</code> columns are both listed as <code>&lt;chr&gt;</code> which indicates that they are currently character-based columns, rather than the needed numeric-based column.</li>
<li>The above issue is caused by all the values within <code>Boom%</code> and <code>Bust%</code> containing a percentage sign at the tail end.</li>
<li>Lastly, the <code>team</code> variable for Baker Mayfield’s has a value of “2 teams” since he played for both the Carolina Panthers and Los Angeles Rams during the 2022 season.</li>
</ol>
<p>To begin dealing with these issues, let’s first tackle cleaning the variable names and then selecting just those columns relevant to our forthcoming data visualization in Chapter 4:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/sis-boom-bust-examine_518a25bc629d1ecf212ed5909ac0f8ca">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">player</span>, <span class="va">team</span>, <span class="va">att</span>, <span class="va">boom_percent</span>, <span class="va">bust_percent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 x 5
   player          team       att boom_percent bust_percent
   &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
 1 Patrick Mahomes Chiefs     648 25.10%       12.50%      
 2 Justin Herbert  Chargers   699 21.20%       15.90%      
 3 Trevor Lawrence Jaguars    584 23.70%       15.20%      
 4 Jared Goff      Lions      587 23.60%       13.30%      
 5 Jalen Hurts     Eagles     460 23.50%       16.10%      
 6 &lt;NA&gt;            &lt;NA&gt;       439 &lt;NA&gt;         10.10%      
 7 Kirk Cousins    Vikings    643 21.30%       17.40%      
 8 Tua Tagovailoa  Dolphins   400 28.50%       15.70%      
 9 Joe Burrow      Bengals    606 23.60%       14.80%      
10 Josh Allen      Bills      567 23.20%       12.70%      
# i 97 more rows</code></pre>
</div>
</div>
<p>In the above code, we are using the <code>clean_names()</code> function within the <code>janitor</code> package to automatically rework the column names into a <code>tidy</code> format. After, we use the <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> verb to keep only five of the included columns of data (<code>player</code>, <code>team</code>, <code>att</code>, <code>boom_percent</code>, and <code>bust_percent</code>). With the column names clean and easy to implement within our code, and with the relevant columns selected, we can move to the process of dealing with the missing data.</p>
</section><section id="dealing-with-missing-data" class="level3" data-number="2.6.2"><h3 data-number="2.6.2" class="anchored" data-anchor-id="dealing-with-missing-data">
<span class="header-section-number">2.6.2</span> Dealing with Missing Data</h3>
<p>Dealing with missing data is an important step in the exploratory data analysis process, as its inclusion can introduce bias, reduce statistical power, and ultimately influence the validity of your research findings. In any case, a missing value within an RStudio dataset is represented by <code>NA</code> values and there are several different approaches to handling the missing data in an effective manner.</p>
<p>A data set can present missing data for a variety of reasons, including participant non-responses (such in social science research), measurement error, or simple data processing issues. The process of handling missing data is ultimately the result of the end goal of the analysis. In some case, conducting a imputation (such as replacing all <code>NA</code> values with the mean of all existing data) is used. In other cases, a more complex method can be utilized such as using the <code>mice</code> package, which can impute missing data based on several different machine learning approaches (predictive mean matching, logistic regression, Bayesian polytomous regression, proportional odds model, etc.). Ultimately, the choice of method for handling missing data depends on the attributes of the data set, your research question, and your domain knowledge of what the data represents.</p>
<p>To begin exploring missing values in our <code>sis_data</code> dataset, we can run the following code:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/explore-missing-data_f5ae7501552e942991ca3e4bf8d9cba4">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data_missing</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter_all.html">filter_all</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/all_vars.html">any_vars</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data_missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 5
  player team    att boom_percent bust_percent
  &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
1 &lt;NA&gt;   &lt;NA&gt;    439 &lt;NA&gt;         10.10%      </code></pre>
</div>
</div>
<p>By using <code><a href="https://dplyr.tidyverse.org/reference/filter_all.html">filter_all()</a></code> across all of our variables (<code>any_vars</code>), we can filter for any missing value, indicated by including <code>is.na</code> in the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. The output shows each row within the data set that includes at least one missing value. In this case, we only have one row with missing data, with values for <code>player</code>, <code>team</code>, and <code>boom_percent</code> all missing. Given the nature of our data, it is not prudent to impute a value in place of the missing data as we have no ability to accurately determine who the player is.</p>
<p>Instead, we will return to our original data set (<code>sis_data</code>) and use the <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> function to drop any row that includes missing data:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/dropping-missing-data_8e4e510a9ee2a6a33a6494b21a7563c0">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">sis_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above code, we are simply “recreating” our existing dataset but using <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> to drop rows that include <code>NA</code> values. Once complete, we can move onto the next step of the data preparation/cleaning process.</p>
</section><section id="changing-variable-types" class="level3" data-number="2.6.3"><h3 data-number="2.6.3" class="anchored" data-anchor-id="changing-variable-types">
<span class="header-section-number">2.6.3</span> Changing Variable Types</h3>
<p>As discovered in the exploratory data analysis process, we know that four columns (<code>player</code>, <code>team</code>, <code>boom_percent</code>, and <code>bust_percent</code>) are listed as a <code>character</code> data type while each quarterback’s number of attempts (<code>att</code>) is listed as a numeric. While we do want both player and team names to be a character-based datatype, we need both the boom and bust percentage for each quarterback to be a numeric value rather than a character.</p>
<p>Moreover, the values in each <code>boom_percent</code> and <code>bust_percent</code> include a percentage sign at the tail-end.</p>
<p>Because of this, we have two issues we need to correct:</p>
<ol type="1">
<li>correctly changing the variable type for <code>boom_percent</code> and <code>bust_percent</code>
</li>
<li>removing the <code>%</code> from the end of each value in <code>boom_percent</code> and <code>bust_percent</code>
</li>
</ol>
<p>Much like many things while working in the R programming language, there exists more than one way to tackle the above issues. In this specific case, we will first look at a method that uses the <code>stringr</code> package before switching the columns from <code>character</code> to <code>numeric</code> using an approach rooted in base R. After, we will use a much easier method to do both at one time.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to note here that I do not necessarily endorse using the first method below to change variable types and to drop the percentage sign, as the second option is ideal.</p>
<p>However, it is important to see how both methods work as there could be a case, somewhere down the road when you are exploring and preparing data yourself, that the first option is the <em>only</em> or <em>best</em> option.</p>
<p>As mentioned, there are typically multiple ways to get to the same endpoint in the R programming language. Showcasing both methods below simply provides you more options in your toolkit for tidying data.</p>
</div>
</div>
<section id="method-1-using-stringr-and-changing-variables" class="level4" data-number="2.6.3.1"><h4 data-number="2.6.3.1" class="anchored" data-anchor-id="method-1-using-stringr-and-changing-variables">
<span class="header-section-number">2.6.3.1</span> Method #1: Using <code>stringr</code> and Changing Variables</h4>
<p>In the below example, we are creating an “example” data frame titled <code>sis_data_stringr</code> from our current iteration of SIS data and then pipe into the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb (covered in more depth in the below <code>Creating New Variables</code> section). It is within this <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb that we can drop the percentage sign.</p>
<p>We first indicate that we are going to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> our already existing columns (both <code>boom_percent</code> and <code>bust_percent</code>). After, we use an <code>=</code> sign to indicate that the following string is the argument to create or, in our case, edit the existing values in the column.</p>
<p>We then use the <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> function from the <code>stringr</code> package to locate the <code>%</code> sign in each value and remove it.</p>
<p>Afterwards, we dive into base R (that is, not <code>tidyverse</code> structure) and use the <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> function to change both of the boom and bust columns to the correct data type (using the <code>$</code> sign to notate that we are working on just one specific column in the data.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/stringr-example-variables_a872d0278ff7f378f3c69065622060fd">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data_stringr</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>boom_percent <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">boom_percent</span>, <span class="st">"%"</span><span class="op">)</span>,</span>
<span>         bust_percent <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">bust_percent</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data_stringr</span><span class="op">$</span><span class="va">boom_percent</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">sis_data_stringr</span><span class="op">$</span><span class="va">boom_percent</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sis_data_stringr</span><span class="op">$</span><span class="va">bust_percent</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">sis_data_stringr</span><span class="op">$</span><span class="va">bust_percent</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data_stringr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106 x 5
   player          team       att boom_percent bust_percent
   &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 Patrick Mahomes Chiefs     648         25.1         12.5
 2 Justin Herbert  Chargers   699         21.2         15.9
 3 Trevor Lawrence Jaguars    584         23.7         15.2
 4 Jared Goff      Lions      587         23.6         13.3
 5 Jalen Hurts     Eagles     460         23.5         16.1
 6 Kirk Cousins    Vikings    643         21.3         17.4
 7 Tua Tagovailoa  Dolphins   400         28.5         15.7
 8 Joe Burrow      Bengals    606         23.6         14.8
 9 Josh Allen      Bills      567         23.2         12.7
10 Geno Smith      Seahawks   572         20.6         17.6
# i 96 more rows</code></pre>
</div>
</div>
<p>Our output shows that <code>att</code>, <code>boom_percent</code>, and <code>bust_percent</code> are now all three numeric and, moreover, the tailing percentage sign in each boom and bust value is now removed. At this point, the data is prepped and properly structured for the visualization process.</p>
</section><section id="method-2-using-the-parse_number-function-in-readr" class="level4" data-number="2.6.3.2"><h4 data-number="2.6.3.2" class="anchored" data-anchor-id="method-2-using-the-parse_number-function-in-readr">
<span class="header-section-number">2.6.3.2</span> Method #2: Using the <code>parse_number</code> Function in <code>readr</code>
</h4>
<p>While the above example using <code>stringr</code> and base R is suitable for our needs, we can use the <code>readr</code> package - and its <code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code> function - to achieve the same results in a less verbose manner.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/readr-examples-variables_cfea4566687500c1d9c347ec27a6164f">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>boom_percent <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">boom_percent</span><span class="op">)</span>,</span>
<span>         bust_percent <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op">(</span><span class="va">bust_percent</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106 x 5
   player          team       att boom_percent bust_percent
   &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 Patrick Mahomes Chiefs     648         25.1         12.5
 2 Justin Herbert  Chargers   699         21.2         15.9
 3 Trevor Lawrence Jaguars    584         23.7         15.2
 4 Jared Goff      Lions      587         23.6         13.3
 5 Jalen Hurts     Eagles     460         23.5         16.1
 6 Kirk Cousins    Vikings    643         21.3         17.4
 7 Tua Tagovailoa  Dolphins   400         28.5         15.7
 8 Joe Burrow      Bengals    606         23.6         14.8
 9 Josh Allen      Bills      567         23.2         12.7
10 Geno Smith      Seahawks   572         20.6         17.6
# i 96 more rows</code></pre>
</div>
</div>
<p>The above example, using <code>readr</code>, is quite similar to the first version that used <code>stringr</code> in that we are using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb to edit our existing <code>boom_percent</code> and <code>bust_percent</code> columns. In this case, however, we are replacing our <code>stringer</code> argument with the <code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code> function from the <code>readr</code> package. When finished, you can see in the output that not only are both boom and bust correctly listed as numeric, but the <code><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number()</a></code> function automatically recognized and dropped the tailing percentage sign.</p>
<p>While both examples get us to the same endpoint, using the <code>readr</code> package allows us to get there with less work.</p>
</section></section><section id="correct-and-create-new-variables-using-mutate" class="level3" data-number="2.6.4"><h3 data-number="2.6.4" class="anchored" data-anchor-id="correct-and-create-new-variables-using-mutate">
<span class="header-section-number">2.6.4</span> Correct and Create New Variables Using <code>mutate</code>
</h3>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb is a powerful and widely used tool that allows us to create new variables (columns) based on existing ones within our data set. To that end, the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb applies a user-supplied argument to each row of the data set to create the new metric. Additionally, the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb - when combined with the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> argument - allows us to make correction to the data (such as the aforementioned issues with Mayfield’s teams).</p>
<p>The syntax of the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb follows the <code>tidyverse</code> flow like many of the other <code>dplyr</code> verbs:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/mutate-example-syntax_e0e725e7f0d619a0cc9ad56f8393467a">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>new_column_name <span class="op">=</span> <span class="fu">user_supplied_argument</span><span class="op">(</span><span class="va">existing_column_name</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb is highly flexible, allowing us to create a new column based on a wide-range of functions and arguments, including mathematical operations, logical operations, string operation, and many more - including applying functions from other packages.</p>
<p>Importantly, the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb allows us to create new variables <strong>without changing the original data set</strong>. While the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb can also create new columns based on various functions and argument, it also distills the data set down to just the columns created within the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> function (plus any column including in the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>). Conversely, the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb creates the new column and adds it on to the current iteration of the data set.</p>
<p>To showcase this, let’s create a new column in our <code>sis_data</code> that calculate the difference between a quarterback’s <code>boom_percent</code> and <code>bust_percent</code>. This is also a great time to limit the quarterbacks we include based on the number of attempts for each. Not doing so results in oddities in the data, such as Christian McCaffrey (a running back) having a 100-percent boom percentage on one passing attempt. To avoid such occurrences, let’s add the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> verb prior to our <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and limit the data to just those quarterbacks with at least 200 passing attempts:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/boom-bust-mutate_1483f0c4ce6a87c390d4d294abf44ddb">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">att</span> <span class="op">&gt;=</span> <span class="fl">200</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>difference <span class="op">=</span> <span class="va">boom_percent</span> <span class="op">-</span> <span class="va">bust_percent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 x 6
   player          team       att boom_percent bust_percent difference
   &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
 1 Patrick Mahomes Chiefs     648         25.1         12.5      12.6 
 2 Justin Herbert  Chargers   699         21.2         15.9       5.3 
 3 Trevor Lawrence Jaguars    584         23.7         15.2       8.5 
 4 Jared Goff      Lions      587         23.6         13.3      10.3 
 5 Jalen Hurts     Eagles     460         23.5         16.1       7.4 
 6 Kirk Cousins    Vikings    643         21.3         17.4       3.90
 7 Tua Tagovailoa  Dolphins   400         28.5         15.7      12.8 
 8 Joe Burrow      Bengals    606         23.6         14.8       8.8 
 9 Josh Allen      Bills      567         23.2         12.7      10.5 
10 Geno Smith      Seahawks   572         20.6         17.6       3   
# i 23 more rows</code></pre>
</div>
</div>
<p>In the above example, by using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb, we created a new column in our existing <code>sis_data</code> data set that calculates the difference between a quarterback’s <code>boom_percent</code> and <code>bust_percent</code>. Importantly, as mentioned, this is done while keeping the rest of the dataset in place unlike using the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> verb.</p>
<p>As mentioned in the introduction to this section, it is possible to include other function within the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb. In fact, doing so is necessary if we wish to make the correction to Baker Mayfield’s team. Currently, Mayfield’s value for <code>team</code> is listed as <code>2 teams</code>. Instead, let’s replace that with his most recent team in the 2022 NFL season (Rams).</p>
<p>To make this correction, we will begin by using the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb on the existing <code>team</code> column in our data set. However, where we calculated the different between boom and bust percent in the above example of <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, we will now use the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> function.</p>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> function allows us to either correct values, or create new columns, based on multiple conditions and values. The syntax of <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> is as follows:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/casewhen-example-syntax_2c69abdeda07e3d269e2dd8d083d1a25">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>column_name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">condition_1</span> <span class="op">==</span> <span class="va">value_1</span> <span class="op">~</span> <span class="va">new_value</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">default_value</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above code, we are essentially saying: “if condition_1 equals value_1, then replace the column_name’s existing value with this new_value.” The final argument, <code>TRUE ~ default_value</code>, specifies the default value to be used if none of the prior conditions are <code>TRUE</code>.</p>
<p>To make this more concrete, let’s work through it using our issue with Baker Mayfield. In order to make the correction, we need to supply the <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> argument three items from the data: the column name that we are applying the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to (in this case, <code>team</code>), the first condition (in this case, <code>player</code>), and the value of that condition (in this case, <code>Baker Mayfield</code>). Next, we need to include the new value (in this case, <code>Rams</code>), and then supply what to do if the above condition is not <code>TRUE</code>. In other words, if the <code>player</code> is not <code>Baker Mayfield</code> then simply keep the existing <code>team</code> in place.</p>
<p>Following that verbal walk through of the process, we can place the conditions and values into the correct spot in the relevant code:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/replacing-baker-team_a4c061321c21a8243ae491c1dd9efd32">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>team <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">player</span> <span class="op">==</span> <span class="st">"Baker Mayfield"</span> <span class="op">~</span> <span class="st">"Rams"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">team</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">player</span> <span class="op">==</span> <span class="st">"Baker Mayfield"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 6
  player         team    att boom_percent bust_percent difference
  &lt;chr&gt;          &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 Baker Mayfield Rams    335           17         18.9      -1.90</code></pre>
</div>
</div>
<p>By filtering the data down to include just Baker Mayfield, we can make sure that his team is now listed as the Rams. Further, a continued look at the data shows no other players’ teams were changed in the process:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/no-teams-harmed_218c3f938297607716ca96213d1083c8">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 x 6
   player          team       att boom_percent bust_percent difference
   &lt;chr&gt;           &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
 1 Patrick Mahomes Chiefs     648         25.1         12.5      12.6 
 2 Justin Herbert  Chargers   699         21.2         15.9       5.3 
 3 Trevor Lawrence Jaguars    584         23.7         15.2       8.5 
 4 Jared Goff      Lions      587         23.6         13.3      10.3 
 5 Jalen Hurts     Eagles     460         23.5         16.1       7.4 
 6 Kirk Cousins    Vikings    643         21.3         17.4       3.90
 7 Tua Tagovailoa  Dolphins   400         28.5         15.7      12.8 
 8 Joe Burrow      Bengals    606         23.6         14.8       8.8 
 9 Josh Allen      Bills      567         23.2         12.7      10.5 
10 Geno Smith      Seahawks   572         20.6         17.6       3   
# i 23 more rows</code></pre>
</div>
</div>
<p>With that, our <code>sis_data</code> data set is nearly complete and ready for visualization. Before doing so, though, we can use the <code>load_teams</code> function within <code>nflreadr</code> to combine the appropriate team colors to each quarterback in the data, allowing us to customize the appearance of the data visualization.</p>
</section><section id="merging-datasets-with-dplyr-and-mutating-joins" class="level3" data-number="2.6.5"><h3 data-number="2.6.5" class="anchored" data-anchor-id="merging-datasets-with-dplyr-and-mutating-joins">
<span class="header-section-number">2.6.5</span> Merging Datasets with <code>dplyr</code> and Mutating Joins</h3>
<p>Mutating joins are a manipulation technique that allows us to add, modify, or remove columns in a data set based on a shared variable or a set of variables. The process is done by matching rows in the data sets based on an matching identifier between the two. Once completed, the matching data from the second data set is added to the first or, conversely, the data within the first dataset is modified as needed to include the incoming data from the second data set.</p>
<p>There are four common mutating joins in the <code>dplyr</code> package:</p>
<ol type="1">
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code>: a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> adds all the columns from the first dataset by only matching columns from the second data set.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code>: a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code> is the opposite of the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> process in that it adds all the columns from the second data set and only matches those columns from the first.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code>: a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code> will only match rows found in both data sets.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code>: a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code> will include all the rows and columns from both data sets.</li>
</ol>
<p>In this instance, using our <code>sis_data</code> data set, we will need to conduct a <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> to bring in NFL team color information. To start, we can use the <code>load_teams()</code> function in <code>nflreadr</code> to load the team information and then use <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> to keep just the information we needed for the merging process:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please note that a much deeper dive into the <code>nflverse</code> functions is included in Chapter 3, including a more detailed approach to working with individual team data. The below code will be expanded upon in the next chapter but, for now, allows us to walk through the merging process.</p>
</div>
</div>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/team-info-for-merge_4eeaf6eb623f4ded8b969e6b8ffd65ae">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">teams</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_teams.html">load_teams</a></span><span class="op">(</span>current <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">team_abbr</span>, <span class="va">team_nick</span>, <span class="va">team_name</span>, <span class="va">team_color</span>, <span class="va">team_color2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">teams</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 x 5
   team_abbr team_nick team_name          team_color team_color2
   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;      &lt;chr&gt;      
 1 ARI       Cardinals Arizona Cardinals  #97233F    #000000    
 2 ATL       Falcons   Atlanta Falcons    #A71930    #000000    
 3 BAL       Ravens    Baltimore Ravens   #241773    #9E7C0C    
 4 BUF       Bills     Buffalo Bills      #00338D    #C60C30    
 5 CAR       Panthers  Carolina Panthers  #0085CA    #000000    
 6 CHI       Bears     Chicago Bears      #0B162A    #C83803    
 7 CIN       Bengals   Cincinnati Bengals #FB4F14    #000000    
 8 CLE       Browns    Cleveland Browns   #FF3C00    #311D00    
 9 DAL       Cowboys   Dallas Cowboys     #002244    #B0B7BC    
10 DEN       Broncos   Denver Broncos     #002244    #FB4F14    
# i 22 more rows</code></pre>
</div>
</div>
<p>For educational purposes, we use the above code to bring in each NFL’s team abbreviation, nickname, and full name. Along with identifying information for each team, we also have selected <code>team_color</code> and <code>team_color2</code> (which correspond to each team’s primary and secondary colors).</p>
<p>As mentioned, we will use the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> function to merge this information into our <code>sis_data</code>. The basic syntax of a <code>left_join</code> includes a call to the original data set, the data set to be merged in, and then an argument to stipulate which variable the join should match on:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/left-join-example-syntax_1c9c0622294b410ad63067fd8228d11a">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_set1</span> <span class="op">&lt;-</span> <span class="va">data_set1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">data_set2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"variable_1"</span> <span class="op">=</span> <span class="st">"variable_2"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above code is stating: “use <code>data_set1</code>, <em>and then</em> conduct a <code>left_join</code> with <code>data_set2</code>, by matching <code>variable_1</code> from <code>data_set1</code> to corresponding <code>variable_2</code> from <code>data_set2</code>.”</p>
<p>To conduct the join, <strong>we must determine which variable in <code>teams</code></strong> <strong>matching a corresponding variable in <code>sis_data</code></strong>. We can use the <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> function to compare the first row of data from each:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/comparing-data_9574cd095e302c621e02ef36686add4a">
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 6
  player          team     att boom_percent bust_percent difference
  &lt;chr&gt;           &lt;chr&gt;  &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 Patrick Mahomes Chiefs   648         25.1         12.5       12.6</code></pre>
</div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">teams</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 5
  team_abbr team_nick team_name         team_color team_color2
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;             &lt;chr&gt;      &lt;chr&gt;      
1 ARI       Cardinals Arizona Cardinals #97233F    #000000    </code></pre>
</div>
</div>
<p>In <code>sis_data</code>, the <code>team</code> column includes the nickname of the NFL team (in this case, the Chiefs). The corresponding variable in our <code>teams</code> data set is the column titled <code>team_nick</code>. Knowing that, we can conduct the <code>left_join</code> using <code>team</code> for <code>variable_1</code> from the above example syntax and <code>team_nick</code> for <code>variable_2</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the columns containing the corresponding data do not have the same name (<code>team</code> vs.&nbsp;<code>team_nick</code>).</p>
<p>It is important to remember that the name of the columns <em>do not</em>&nbsp;have to match. It is the values contained within the column that must match.</p>
</div>
</div>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/left-joining-sis-with-teams_ddadd334142b92ce0c03b75f636acc40">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sis_data</span> <span class="op">&lt;-</span> <span class="va">sis_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">teams</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"team"</span> <span class="op">=</span> <span class="st">"team_nick"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sis_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 x 10
   player   team    att boom_percent bust_percent difference team_abbr
   &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    
 1 Patrick~ Chie~   648         25.1         12.5      12.6  KC       
 2 Justin ~ Char~   699         21.2         15.9       5.3  LAC      
 3 Trevor ~ Jagu~   584         23.7         15.2       8.5  JAX      
 4 Jared G~ Lions   587         23.6         13.3      10.3  DET      
 5 Jalen H~ Eagl~   460         23.5         16.1       7.4  PHI      
 6 Kirk Co~ Viki~   643         21.3         17.4       3.90 MIN      
 7 Tua Tag~ Dolp~   400         28.5         15.7      12.8  MIA      
 8 Joe Bur~ Beng~   606         23.6         14.8       8.8  CIN      
 9 Josh Al~ Bills   567         23.2         12.7      10.5  BUF      
10 Geno Sm~ Seah~   572         20.6         17.6       3    SEA      
# i 23 more rows
# i 3 more variables: team_name &lt;chr&gt;, team_color &lt;chr&gt;, ...</code></pre>
</div>
</div>
<p>You can see in the output that our two data sets correctly merged on the <code>team</code> and <code>team_nick</code> columns. Moreover, to illustrate what happens doing the joining process, please note these two items:</p>
<ol type="1">
<li>The <code>team_nick</code> column from our <code>teams</code> data set is not included in our merged <code>sis_data</code>, as it is dropped after matching/merging with the <code>team</code> information from our original data set.</li>
<li>While the <code>team_nick</code> column was dropped, the other team identifiers (<code>team_abbr</code> and <code>team_name</code>) were kept intact, as they were not used in the matching process. As well, <code>team_color</code> and <code>team_color2</code> are now correctly matched with each quarterback’s team.</li>
</ol></section></section><section id="exercises" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">2.7</span> Exercises</h2>
<p>The answers for the following answers can be found here: <a href="http://nfl-book.bradcongelio.com/ch2-answers" class="uri">http://nfl-book.bradcongelio.com/ch2-answers</a>.</p>
<p>Create a data frame titled <code>pbp</code> that contains the play-by-play information for the 2022 regular season by running the following code:</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/chap-1-exercise-1_4cdba30f0ca6493120b636aa918512af">
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbp</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_pbp.html">load_pbp</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">season_type</span> <span class="op">==</span> <span class="st">"REG"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After, using the data in <code>pbp</code>, complete the following:</p>
<section id="exercise-1" class="level3" data-number="2.7.1"><h3 data-number="2.7.1" class="anchored" data-anchor-id="exercise-1">
<span class="header-section-number">2.7.1</span> <strong>Exercise 1</strong>
</h3>
<ol type="1">
<li>Use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> to select only Patrick Mahomes and all passes that resulted in interceptions.</li>
<li>Add a <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> to determine the average air yards (<code>air_yards</code>) for his combined interceptions.</li>
</ol></section><section id="exercise-2" class="level3" data-number="2.7.2"><h3 data-number="2.7.2" class="anchored" data-anchor-id="exercise-2">
<span class="header-section-number">2.7.2</span> <strong>Exercise 2</strong>
</h3>
<ol type="1">
<li>In a data frame titled <code>wide_receivers</code>, find the average yards after catch (<code>yards_after_catch</code>) and average yards after catch EPA (<code>yac_epa</code>) for the top-10 receivers in total receiving yards. In doing so, you will need to use <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> on <code>receiver</code>.</li>
</ol></section><section id="exercise-3" class="level3" data-number="2.7.3"><h3 data-number="2.7.3" class="anchored" data-anchor-id="exercise-3">
<span class="header-section-number">2.7.3</span> <strong>Exercise 3</strong>
</h3>
<ol type="1">
<li>In a data frame titled <code>qb_hits</code>, find the total number of times each defensive unit (<code>defteam</code>) recorded a QB hit (<code>qb_hit</code>).</li>
</ol></section><section id="exercise-4" class="level3" data-number="2.7.4"><h3 data-number="2.7.4" class="anchored" data-anchor-id="exercise-4">
<span class="header-section-number">2.7.4</span> <strong>Exercise 4</strong>
</h3>
<ol type="1">
<li>
<p>After running the following code, add a column titled <code>difference</code> using that <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> verb that calculates the difference between each quarterback’s <code>total_completions</code> and <code>total_incompletions</code>.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/question-4-ch-2_28991e8a7f910ece378c0feb65ce1309">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cmp_inc</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">complete_pass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span></span>
<span>           <span class="va">incomplete_pass</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">|</span></span>
<span>           <span class="va">interception</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">down</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">passer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total_completions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">complete_pass</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>                                    na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            total_incompletions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">incomplete_pass</span> <span class="op">==</span> <span class="fl">1</span>,</span>
<span>                                      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">total_completions</span> <span class="op">&gt;=</span> <span class="fl">180</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol></section><section id="exercise-5" class="level3" data-number="2.7.5"><h3 data-number="2.7.5" class="anchored" data-anchor-id="exercise-5">
<span class="header-section-number">2.7.5</span> <strong>Exercise 5</strong>
</h3>
<ol type="1">
<li>
<p>After running the following code, use the <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> function to merge the two data frames together into a single data frame titled <code>rb_success_combined</code>.</p>
<div class="cell" data-hash="02-nfl-analytics-tidyverse_cache/html/question-5-ch1-ch2_bae7c99e183bd6b417e8243c1fad1d4c">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">roster_information</span> <span class="op">&lt;-</span> <span class="fu">nflreadr</span><span class="fu">::</span><span class="fu"><a href="https://nflreadr.nflverse.com/reference/load_rosters.html">load_rosters</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">full_name</span>, <span class="va">gsis_id</span>, <span class="va">headshot_url</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rb_success</span> <span class="op">&lt;-</span> <span class="va">pbp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rusher_player_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">rusher</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">success</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>total_success <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">success</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">total_success</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, H. (2022). <em>Tidyverse packages</em>. Retrieved from <a href="https://www.tidyverse.org/packages/">https://www.tidyverse.org/packages/</a>
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01-nfl-analytics-and-r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An Introduction to NFL Analytics and the R Programming Language</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-nfl-analytics-functions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NFL Analytics with the <code>nflverse</code> Family of Packages</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
